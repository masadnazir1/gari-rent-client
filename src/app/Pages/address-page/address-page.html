<div class="address-page-wrap">
  <form [formGroup]="form" (ngSubmit)="saveAddress()" class="address-form">
    <h2>Address & Location</h2>
    <p class="hint">
      Enter your address manually or use browser location to auto-fill
      coordinates.
    </p>

    <div class="group">
      <div class="field">
        <label for="street">Street</label>
        <input
          id="street"
          type="text"
          formControlName="street"
          placeholder="e.g. 123 Main St"
        />
        <div class="error" *ngIf="street?.touched && street?.invalid">
          <span *ngIf="street?.errors?.['required']">Street is required.</span>
          <span *ngIf="street?.errors?.['minlength']"
            >Please enter a valid street.</span
          >
        </div>
      </div>

      <div class="field">
        <label for="city">City</label>
        <input
          id="city"
          type="text"
          formControlName="city"
          placeholder="e.g. Toronto"
        />
        <div class="error" *ngIf="city?.touched && city?.invalid">
          <span *ngIf="city?.errors?.['required']">City is required.</span>
        </div>
      </div>

      <div class="field">
        <label for="province">Province / State</label>
        <input
          id="province"
          type="text"
          formControlName="province"
          placeholder="e.g. Ontario"
        />
        <div class="error" *ngIf="province?.touched && province?.invalid">
          <span *ngIf="province?.errors?.['required']"
            >Province / State is required.</span
          >
        </div>
      </div>

      <div class="field">
        <label for="country">Country</label>
        <!-- datalist allows search + manual typing -->
        <input
          id="country"
          list="country-list"
          formControlName="country"
          placeholder="Type or choose a country"
        />
        <datalist id="country-list">
          <option *ngFor="let c of countries">{{ c }}</option>
        </datalist>
        <div class="error" *ngIf="country?.touched && country?.invalid">
          <span *ngIf="country?.errors?.['required']"
            >Country is required.</span
          >
        </div>
      </div>

      <div class="field">
        <label for="zip">Zip / Postal Code</label>
        <input
          id="zip"
          type="text"
          formControlName="zip"
          placeholder="e.g. M5H 2N2"
        />
        <div
          class="error"
          *ngIf="(zip?.touched && zip?.invalid) || zipHasCountryError()"
        >
          <span *ngIf="zip?.errors?.['required']"
            >Zip / Postal Code is required.</span
          >
          <span *ngIf="form.errors?.['zipInvalidForCountry']"
            >Zip / Postal Code doesn't match selected country format.</span
          >
        </div>
      </div>
    </div>

    <div class="coords-section">
      <div class="coords-actions">
        <button
          type="button"
          class="btn-geo"
          (click)="useCurrentLocation()"
          [disabled]="fetchingLocation"
        >
          <fa-icon [icon]="faLocationDot"></fa-icon>
          <span *ngIf="!fetchingLocation">Use My Current Location</span>
          <span *ngIf="fetchingLocation">Fetching...</span>
        </button>

        <div class="geo-error" *ngIf="geoError">{{ geoError }}</div>
      </div>

      <div class="coords-fields">
        <div class="coord">
          <label>Latitude</label>
          <input type="number" formControlName="latitude" readonly />
        </div>
        <div class="coord">
          <label>Longitude</label>
          <input type="number" formControlName="longitude" readonly />
        </div>
      </div>
    </div>

    <!-- Preview line -->
    <div class="preview" *ngIf="previewLine">
      {{ previewLine }}
    </div>

    <!-- Actions -->
    <div class="actions">
      <button type="submit" class="btn-save" [disabled]="form.invalid">
        <fa-icon [icon]="faSave"></fa-icon> Save Address
      </button>
    </div>
  </form>
</div>
